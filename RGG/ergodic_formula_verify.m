%%This file is a matlab/octave file to check whether 
%the binomial probabilites calculated for the ergodic 
%result in prob_fwding_results.py are correct, esp., 
%when you change cdf to 1- cdf

k=20;
delta=0.1;
lbda = 4.5;
lamb = 1:0.01:4.99;
theta_lambda_251=[0.004087063024307583, 0.004181944306808047, 0.004525674443667668, 0.004525674443667668, 0.0049411959993436545, 0.005113381310777101, 0.005228436754824509, 0.005663638743771079, 0.005870877716950589, 0.006243993826381541, 0.006782226060370247, 0.007338120630237129, 0.00745123479081474, 0.00804266136582943, 0.00878908474516268, 0.009175823717986477, 0.010212804144549276, 0.011000310395216326, 0.01187051967465568, 0.012396249072004912, 0.013377432172669233, 0.014202933845326091, 0.015663759874500114, 0.017017833319603024, 0.01867610212591191, 0.021034363206173943, 0.02268317362296154, 0.02572489731133776, 0.02738905029566653, 0.03251586574378638, 0.03647223923061373, 0.03895854241276284, 0.04718110861284699, 0.05396328550350571, 0.06489426536361326, 0.07184690891675823, 0.08274571271927025, 0.11047028036499285, 0.1268160241635543,  0.1519159953545862, 0.1944731642163107, 0.2437025781365562, 0.28879676511938623, 0.34628999375948627, 0.43343719130560404, 0.5115604490652533, 0.5897102415359801, 0.6350006264749436, 0.6969273544740336, 0.7574960292000544, 0.7881517517152711, 0.8066506451769426, 0.8316779106504575, 0.8526400872261871, 0.8687933012235086, 0.8762961415732236, 0.8874480522784907, 0.8973706800589685, 0.9047805948506658, 0.9137506373323285, 0.9203545024478027, 0.9266770384175648, 0.9287450332015117, 0.9337191116544914, 0.9380372450225469, 0.9424102460493857, 0.9445587365625677, 0.9478927354867722, 0.9516509220480021, 0.9537536055867618, 0.9564288064896479, 0.959382453697324, 0.9608484040855778, 0.9634927566525624, 0.9654574018719495, 0.9671761426823935, 0.9689055793688874,0.9704330688327565, 0.9718682461594904, 0.9736772110032115, 0.9747012793784039, 0.9760724345414891, 0.9767786589106774, 0.9783001481457917, 0.979293613316785, 0.9803297342461487, 0.9812279275003117, 0.9818150654840797, 0.9828580221340233, 0.9837783243815521, 0.9844448114306656, 0.9847586589281935, 0.9855980528613626, 0.9862851895979176, 0.9869720862556073, 0.9875901231876731, 0.9879693791790569, 0.9886032923952554, 0.9891302495882512, 0.9896132774656456, 0.9899153222633714, 0.9877673738112656, 0.9885975639345854, 0.988953112173451, 0.9892095526404305, 0.9896064648783053, 0.9900851772543422, 0.990367002888668, 0.9908850558461757, 0.9914431780873317, 0.9912892685431545, 0.9925895470383276, 0.9925861192028483, 0.9927608265451702, 0.9928340433328752, 0.9930123558108785, 0.9933242568640799, 0.9934065139811176, 0.9939502675480013, 0.9941999015263417, 0.9943839950095799, 0.9943100465735196, 0.9947878306177418, 0.9950907732208009, 0.9951026213294822, 0.9952864549296389, 0.9956911732812839, 0.9955913978494624, 0.9957663700073089, 0.9961534180899789, 0.9960780803818778, 0.9963229365584553, 0.9964452613343474, 0.996488703773823, 0.9967052071551256, 0.9966850206482293, 0.9967788161993769, 0.9970248583364355, 0.9970147040652415, 0.9971223493704114, 0.997283421149369, 0.9974329875940614, 0.9974156438611415, 0.9974516922828675, 0.9974946767908079, 0.9976665466330573, 0.9978374178123133, 0.9978215660594515, 0.9977856832285862, 0.9980181882603048, 0.9980939497314041, 0.9980921694981448, 0.998104407359863, 0.9982548723313573, 0.9983636293466095, 0.9983062314996348, 0.9985184759716639, 0.9985913720105275, 0.9984414301455223, 0.9985980848567428, 0.9986317535723711, 0.9985780281690141, 0.9987125378830396, 0.9987360691788736, 0.9987560803534961, 0.9988347575185884, 0.9988251335913028, 0.9989481220398723, 0.9989366838582245, 0.999012426660836, 0.9989703372907818, 0.9989990956773377, 0.9990449417955094, 0.9991353369959424, 0.9991599584988015, 0.9990653406052828, 0.999202628307583, 0.9991980748133206, 0.9992545576360239, 0.9992470398088612, 0.9992483282568358, 0.9992705389848247, 0.9992877255188236, 0.999318646298798, 0.9993238065651859, 0.9994059780552402, 0.9993994858611824, 0.9994111418519657, 0.9994138670478914, 0.9994043621315423, 0.9995000507047966, 0.9994145191173993, 0.9995038103870816, 0.9995111914082103, 0.9995632022940215, 0.9995045359385903, 0.9995754263950986, 0.9995425289632637, 0.9995881443468535, 0.9995921445198518, 0.9995693232689605, 0.9995977984758678, 0.9996117891456764, 0.9996253639598836, 0.9996362698310332, 0.9996734588931028, 0.9996767683239365, 0.9996554696979374, 0.999676002546149, 0.9997046507201319, 0.9997144573741462, 0.9997267225619366, 0.9997285409073772, 0.9997388036329471, 0.9997180944055944, 0.9997454409659551, 0.9997415932497828, 0.9997792071247449, 0.99972934648582, 0.9997424866326594, 0.9997466609484132, 0.9997758504855555, 0.9997844617632733, 0.9997635811836115, 0.9997924482633427, 0.9998048500935031, 0.99982649747414, 0.9998054439714612, 0.999809922295278, 0.9998239079911805, 0.9998300855513308, 0.99981993721495, 0.9998322900673202, 0.9998439799823373, 0.9998488494951867, 0.9998370105928484, 0.9998637530633679, 0.9998632846587934, 0.9998538283062645, 0.9998692961656352, 0.9998884211740284, 0.9998542517104582, 0.9998492318275625, 0.9998822520720206, 0.9998911432805199, 0.9998820821730977, 0.9998756233000907, 0.999894344313238, 0.9998985915492957, 0.9998988820852762, 0.9999081335424603, 0.9999014131709769, 0.9999016932159964, 0.9999039155790058, 0.9999041869738591, 0.999898105704976, 0.9998926093182068, 0.9999066395738372, 0.9999047097480832, 0.9999243624051117, 0.9999191264568129, 0.9999160918915984, 0.9999260723570191, 0.9999314069673239, 0.9999305181514596, 0.9999352742117419, 0.9999244696807371, 0.9999334900368609, 0.9999453915823122, 0.9999309282184794, 0.999948601102162, 0.9999437192834116, 0.9999359650047434, 0.9999521681997372, 0.9999460054518766, 0.9999526846865687, 0.9999460319115653, 0.9999461750481045, 0.9999445020746888, 0.9999456830996845, 0.9999576927045714, 0.9999529151443421, 0.9999497023198523, 0.9999503455336576, 0.9999548146635352, 0.9999508580740439, 0.9999547947988623, 0.9999642839049598, 0.9999613441131885, 0.9999556473968046, 0.9999582746832898, 0.9999596349596349, 0.9999674902470741, 0.9999665752057869, 0.9999609375, 0.9999714597706855, 0.999977225467868, 0.9999708627586547, 0.999970197044335, 0.9999719915483268, 0.9999610332320361, 0.9999645537438581, 0.9999734204686775, 0.9999751891221328, 0.9999718535413584, 0.9999719230303764, 0.9999741651978655, 0.9999694115946915, 0.9999759736671392, 0.999979387867603, 0.9999753735803946, 0.9999804421971522, 0.9999726379404698, 0.9999805368968218, 0.9999767953969645, 0.9999806306838314, 0.9999813841694747, 0.9999736712193517, 0.9999849909711311, 0.9999815174414525, 0.9999871630295251, 0.9999820709246281, 0.9999742154289298, 0.9999849366179231, 0.999979654590433, 0.9999797024564642, 0.9999857330234485, 0.9999843889896463, 0.9999869448707084, 0.9999888033270113, 0.9999756069759489, 0.9999847612982464, 0.9999818466495722, 0.9999889067487718, 0.999985995979491, 0.9999806197183099, 0.99998673471682, 0.9999849705018058, 0.9999818714889998, 0.9999897282450929, 0.9999881920463406, 0.9999782159290461, 0.9999900197387389, 0.9999887145670598, 0.9999869737045459, 0.9999898667254102, 0.9999901092379717, 0.9999883769380908, 0.999986871184438, 0.9999879920529223, 0.9999901971462803, 0.9999876105809986, 0.9999939274328223, 0.9999913440522818, 0.9999902835057111, 0.9999883658300118, 0.9999892512414816, 0.9999916343121903, 0.9999922946854735, 0.9999927386113662, 0.9999910495471497, 0.9999946839049908, 0.9999896030045196, 0.9999894137325062, 0.9999911266980753, 0.9999867186676505, 0.9999915855018195, 0.9999918134301727, 0.9999895268218093, 0.9999954016261522, 0.999993534258004, 0.9999922992070265, 0.9999925232092047, 0.999994197011461, 0.9999906934419788, 0.9999954597048809, 0.999993409807031, 0.9999946566924927, 0.9999932322963023, 0.9999905859239097, 0.9999938731747166, 0.9999947011229543, 0.9999943053550001, 0.9999886342879178, 0.9999898730075142, 0.9999963617988884, 0.9999961675777074, 0.9999949676925864, 0.9999977903216086, 0.9999949882725577, 0.9999945983795139, 0.9999920138958213, 0.9999962143099086, 0.9999942335606768, 0.9999972218363662, 0.9999942568571146, 0.9999950589955927, 0.9999940827235251, 0.9999946851439933, 0.9999976425750938];
p = 0.33:0.0000001:0.65;
lbda_p = lbda*p;
theta_lbda_p = interp1(lamb,theta_lambda_251,lbda_p);

pkndelta_ergodic = zeros(k+1,1);
n=k;
index=1;
while n<=40
minp_index = 0;
prob = lbda*binocdf(k-1,n,theta_lbda_p.*theta_lbda_p,'upper');
minp_index = min(find(prob>=(1-delta)));
pkndelta_ergodic(index)=p(minp_index);
index=index+1;
n=n+1;
end
pkts=20:1:40;
pkndelta_simu1=[0.519,0.448,0.417,0.395,0.386,0.377,0.369,0.365,0.3605,0.357,0.355,0.35280,0.34980,0.34840,0.34720,0.3457,0.3438,0.34300,0.34210,0.3409,0.3401];
tau_kndelta_simu1=[473877.0, 421523.66, 404229.58, 385503.37, 389178.52, 384351.29, 383509.59, 387956.2, 383379.07, 390788.11, 394998.01, 397147.49, 393409.78, 402471.6, 404411.08, 409427.06, 409307.46, 409587.61, 422560.22, 419275.77, 416047.03];
theta_pkndelta = interp1(lamb,theta_lambda_251,lbda*pkndelta_ergodic);
tau_kndelta_ergodic = lbda*pkndelta_ergodic.*theta_pkndelta.*theta_pkndelta.*pkts';

figure(1)
plot(pkts,pkndelta_simu1,pkts,pkndelta_ergodic,'--')
figure(2)
plot(pkts,tau_kndelta_simu1/(101*101),pkts,tau_kndelta_ergodic,'--')